# HTTP 报文

用于 HTTP 协议交互的信息

请求端（客户端） --- 请求报文

响应端（服务器）--- 响应报文

报文结构

```
首部

空行

主体
```

# 请求报文及响应报文的结构

# 编码提升传输率

## 报文主体和实体主体的差异

1. 报文

HTTP 中通信的基本单位

2. 实体

作为请求或者响应的有效载荷被传输，由实体首部和实体主体组成

> 通常报文主体等于实体主体。只有当传输中进行**编码操作**时，实体主体的内容发生变化，才导致它和报文主体产生差异。

## 压缩传输的内容编码

内容编码指明 应用在实体内容上的编码格式，并保持实体信息原样压缩。内容编码后的实体由客户端接收并负责解码。

常用的内容编码

1. gzip

2. compress

3. deflate

4. identity（不进行编码）

## 分割发送的分块传输编码

在 HTTP 通信过程中，请求的编码实体资源尚未全部传输完成之前，浏览器无法显示请求页面。在传输大容量数据时，通过把数据分割成多块，能够让浏览器逐步显示页面。

分块传输编码会将实体主体分成多个部分。每一块都会用十六进制来标记块的大小，而实体主体的最后一块会使用“0(CR+LF)”来标记。

分块编码的实体主体会由接收的客户端负责解码，恢复到编码之前的实体主体。

HTTP1.1 中有一种传输编码的机制，用于分块传输编码

# 发送多种数据的多部分对象集合

多部分对象集合（multipart）

多部分对象集合包含的对象如下：

1. multipart/form-data

2. multipart/byteranges

在 HTTP 报文中使用多部分对象集合时，需要在首部字段里加上 Content-type，作为 Content-Type 的 value。

# 获取部分内容的范围请求

执行范围请求时，会用到首部字段 **Range** 来指定资源的 byte 范围。

1. 5001-10000

Range: bytes=5001-10000

2. 从 5001 字节后的全部

Range: bytes=5001-

3. 从一开始到 3000 字节和 5000 ～ 7000 字节的多重范围

Range: bytes=-3000, 5000-7000

针对**范围请求**，响应会返回状态码为 **206 Partial Content** 的响应报文。

对于**多重范围**的范围请求，响应会在首部字段 Content-Type 标明 multipart/byteranges 后返回响应报文。

> 如果服务器无法响应范围请求，则会返回 200 OK，并返回完整的实体内容

# 内容协商返回最合适的内容

内容协商会以响应资源的语言、字符集、编码方式等作为判断的基准。

主要字段

1. Accept

2. Accept-Charset

3. Accept-Language

4. Accept-Encoding

5. Content-Language

内容协商技术有以下 3 种类型。

1. 服务器驱动协商

由服务器端进行内容协商。以请求的首部字段为参考，在服务器端自动处理。

2. 客户端驱动协商

由客户端进行内容协商的方式。用户从浏览器显示的可选项列表中手动选择。

3. 透明协商

前两种的结合体。由服务器端和客户端各自进行内容协商的一种方法。
