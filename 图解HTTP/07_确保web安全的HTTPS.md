# HTTP 的缺点

## 通信使用明文，可能被窃听

HTTP 的报文使用的是明文进行发送的，不会进行加密

### TCP/IP 是可能被窃听的网络

### 加密处理防止被窃听

1. 通信的加密

HTTP 协议中没有加密机制，但可以通过和 SSL（Secure Socket Layer，安全套接层）或 TLS（Transport Layer Security，安全传输层协议）的组合使用，加密 HTTP 的通信内容。

用 SSL 建立安全通信线路之后，就可以进行 HTTP 通信了。与 SSL 配合使用的 HTTP 成为 HTTPS/HTTP over SSL

2. 内容的加密

客户端对 HTTP 的报文进行加密处理之后再发送请求

为了做到有效的加密，前提是要求客户端和服务器同时具备加密和解密机制。但是这种方式传输由于不是对通信线路的加密，所以内容还是可能会被篡改

## 不验证通信方的身份就可能遭遇伪装

HTTP 协议不会对请求和响应的双方进行身份验证

### 任何人都可以发起请求

任何人都可以发起请求，并且服务器收到请求之后，不管请求方是谁都会返回响应

隐患

1. 无法确认请求的服务器是否是目的服务器（还是伪装的服务器）

2. 无法确认响应返回到的客户端是目标客户端（还是伪装的客户端）

3. 无法确认正在通信的双方是否具有权限

4. 无法判断请求来自何方

5. 即使是无意义的请求也会照单全收。 无法防备 Dos 攻击

### 查明对手的证书

虽然使用 HTTP 协议无法确定通信方，但如果使用 SSL 则可以。SSL 不仅提供加密处理，而且还使用了一种被称为证书的手段，可用于确定方。

证书是由信赖的第三方颁发的，用以证明客户端和服务器是真实存在的。伪造证书是一件很困难的事情，所以只要能够确认通信双方含有证书，即可判断通信双发的真实意图。

## 无法证明报文的完整性，可能已经遭到篡改

### 接收到的内容可能有误

发送的报文可能被中间人拦截进行了篡改

### 如何防止篡改

SSL 提供认证和加密处理及摘要功能

# HTTP+加密+认证+完整性保护=HTTPS

## HTTP 加上加密处理和认证以及完整性保护后即是 HTTPS

http 的缺点

1. 信息明文传递

2. 无法确定通信双方身份

3. 通信内容可能在传递的过程中被篡改

https -> 添加了加密、认证、完整性校验的 http -> http + ssl

## HTTPS 是身披 SSL 外壳的 HTTP

通常情况下 http 直接和 tcp 进行通信；而 https 则是先和 ssl 通信，ssl 再和 tcp 通信

在 http 加上 ssl 之后 就具有了： 加密、认证、完整性保护等功能

**ssl 协议是独立于 http 的，也就是说其它应用层协议也可以使用 ssl 来提供安全通信**

## 相互交换密钥的公开密钥加密技术

ssl 采用的是**公开密钥加密**的加密方法

加密方法是公开的，但是密钥确实保密的。

加密和解密都需要密钥。所以只要有密钥就可以进行加解密。

### 对称加密（共享密钥加密）的缺点

对称加密：加密和解密使用相同的密钥

对称加密时需要将密钥也发送给对方。那么怎么安全的密钥发送给对方就是一个问题

### 使用两把密钥的公开密钥加密

公开密钥加密的方式很好的解决了使用公开密钥的困难

公开密钥加密使用一对**非对称的密钥**。一把叫做私有密钥（private key），另一把叫做公开密钥（public key）。顾名思义，私有密钥不能让其他任何人知道，而公开密钥则可以随意发布，任何人都可以获得。

原理： 发送密文的一方使用对方的公开密钥进行加密处理，对方收到被加密的信息后，再使用自己的私有密钥进行解密。利用这种方式，不需要发送用来解密的私有密钥，也不必担心密钥被攻击者窃听而盗走。

公钥 ---》 加密

私钥 ---》 解密

### HTTPS 采用混合加密机制

HTTPS 采用共享密钥加密和公开密钥加密两者并用的混合加密机制。

在**交换密钥环节**使用公开密钥加密方式，之后的建立通信**交换报文阶段**则使用共享密钥加密方式。

公开密钥加密处理起来比共享密钥加密更复杂，所以在通信的时候使用公开密钥加密效率较低。

步骤：

1. 使用公开密钥加密的方式安全的交换在稍后共享密钥加密中要使用的密钥

2. 确保密钥是安全的情况下使用共享密钥加密通信

### 证明公开密钥正确性的证书

公开密钥加密的问题： 无法证明公开密钥本身的正确性

解决方式：

数字证书认证机构（CA,Certificate Authority）和其相关机关颁发的公开密钥证书。

服务器会将这份由数字证书认证机构颁发的公钥证书发送给客户端，以进行公开密钥加密方式通信。公钥证书也可叫做数字证书或直接称为证书。

接到证书的客户端可使用数字证书认证机构的公开密钥，对那张证书上的数字签名进行验证，一旦验证通过，客户端便可明确两件事：一，认证服务器的公开密钥的是真实有效的数字证书认证机构。二，服务器的公开密钥是值得信赖的。

### 用以确认客户端的客户端证书

HTTPS 中还可以使用客户端证书。以客户端证书进行客户端认证，证明服务器正在通信的对方始终是预料之内的客户端，其作用跟服务器证书如出一辙。

### 认证机构信誉第一

### 由自认证机构颁发的证书称为自签名证书

## HTTPS 的安全通信机制

1. 客户端通过发送 Client Hello 报文开始 SSL 通信。报文中包含客户端支持的 SSL 的指定版本、加密组件（Cipher Suite）列表（所使用的加密算法及密钥长度等）。

2. 服务器可进行 SSL 通信时，会以 Server Hello 报文作为应答。和客户端一样，在报文中包含 SSL 版本以及加密组件（是从客户端的加密组件中筛选出来的）。

3. 之后服务器发送 Certificate 报文。报文中包含公开密钥证书。

4. 最后服务器发送 Server Hello Done 报文通知客户端，最初阶段的 SSL 握手协商部分结束。

5. SSL 第一次握手结束之后，客户端以 Client Key Exchange 报文作为回应。报文中包含通信加密中使用的一种被称为 Pre-master secret 的随机密码串。该报文已用步骤 3 中的公开密钥进行加密。

6. 接着客户端继续发送 Change Cipher Spec 报文。该报文会提示服务器，在此报文之后的通信会采用 Pre-master secret 密钥加密。

7. 客户端发送 Finished 报文。该报文包含连接至今全部报文的整体校验值。这次握手协商是否能够成功，要以服务器是否能够正确解密该报文作为判定标准。

8. 服务器同样发送 Change Cipher Spec 报文（使用自己的私钥解密出客户端的 Pre-master secret ）。

9. 服务器同样发送 Finished 报文。

10. 服务器和客户端的 Finished 报文交换完毕之后，SSL 连接就算建立完成。从此处开始进行应用层协议的通信，即发送 HTTP 请求。

11. 应用层协议通信，即发送 HTTP 响应。

12. 最后由客户端断开连接。断开连接时，发送 close_notify 报文。

在以上流程中，应用层发送数据时会附加一种叫做 MAC（MessageAuthentication Code）的报文摘要。**MAC 能够查知报文是否遭到篡改**，从而保护报文的完整性。

### SSL 和 TLS

TSL 是以 SSL 为原型开发的协议，有时会统一称该协议为 SSL。

### SSL 速度慢吗

SSL 的慢分两种。

一种是指通信慢。

另一种是指由于大量消耗 CPU 及内存等资源，导致处理速度变慢。

### ？ 为什么不一直使用 HTTPS 既然 HTTPS 那么安全可靠，那为何所有的 Web 网站不一直使用 HTTPS？

1. 因为与纯文本通信相比，加密通信会消耗更多的 CPU 及内存资源。因此，如果是非敏感信息则使用 HTTP 通信，只有在包含个人信息等敏感数据时，才利用 HTTPS 加密通信。

2. 节约购买证书的开销
