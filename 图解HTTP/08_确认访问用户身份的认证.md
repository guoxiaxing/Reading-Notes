# 何为认证

需要核对的信息

1. 密码

2. 动态令牌

3. 数字证书

4. 生物认证

5. IC 卡

## HTTP 使用的认证方式

1. BASIC 认证

2. DIGEST 认证（摘要认证）

3. SSL 客户端认证

4. FORM BASE 认证（基于表单的认证）

# BASIC 认证

## 步骤

1.  当请求的资源需要 BASIC 认证时，服务器会随状态码 401Authorization Required，返回带 WWW-Authenticate 首部字段的响应。该字段内包含认证的方式（BASIC）及 Request-URI 安全域字符串（realm）。

2.  接收到状态码 401 的客户端为了通过 BASIC 认证，需要将用户 ID 及密码发送给服务器。发送的字符串内容是由用户 ID 和密码构成，两者中间以冒号（:）连接后，再经过 Base64 编码处理。把这串字符串写入首部字段 Authorization 后，发送请求。（浏览器会自动完成到 Base64 编码的转换工作。）

3.  接收到包含首部字段 Authorization 请求的服务器，会对认证信息的正确性进行验证。如验证通过，则返回一条包含 Request-URI 资源的响应。

## BASIC 认证的缺点

1. 认证信息只经过了 base64 编码但这并不是加密，所以存在安全性问题

2. 如果再向进行一次 BASIC 认证，一般浏览器无法进行注销操作

3. 使用不够灵活，达不到 Web 网站期望的安全等级，所以不常用

# DIGEST 认证

## 步骤

1. 请求需认证的资源时，服务器会随着状态码 401，返回带 WWW-Authenticate 首部字段的响应。该字段内包含质问响应方式认证所需的临时质询码（随机数，nonce）。

首部字段 WWW-Authenticate 内必须包含 realm 和 nonce 这两个字段的信息。

客户端就是依靠向服务器回送这两个值进行认证的。nonce 是一种每次随返回的 401 响应生成的任意随机字符串。该字符串通常推荐由 Base64 编码的十六进制数的组成形式，但实际内容依赖服务器的具体实现。

2. 接收到 401 状态码的客户端，返回的响应中包含 DIGEST 认证必须的首部字段 Authorization 信息。

首部字段 Authorization 内必须包含 username、realm、nonce、uri 和 response 的字段信息。

其中，realm 和 nonce 就是之前从服务器接收到的响应中的字段。

3.  接收到包含首部字段 Authorization 请求的服务器，会确认认证信息的正确性。认证通过后则返回包含 Request-URI 资源的响应。

并且这时会在首部字段 Authentication-Info 写入一些认证成功的相关信息。

# SSL 客户端认证

需要事先将客户端证书分发给客户端，且客户端必须安装此证书。

## 步骤

1. 接收到需要认证资源的请求，服务器会发送 Certificate Request 报文，要求客户端提供客户端证书。

2. 用户选择将发送的客户端证书后，客户端会把客户端证书信息以 Client Certificate 报文方式发送给服务器。

3. 服务器验证客户端证书验证通过后方可领取证书内客户端的公开密钥，然后开始 HTTPS 加密通信。

## SSL 客户端认证采用双因素认证

SSL 客户端认证不会仅依靠证书完成认证，一般会和基于表单认证（稍后讲解）组合形成一种双因素认证（Two-factor authentication）来使用

第一个认证因素的 SSL 客户端证书用来认证客户端计算机，另一个认证因素的密码则用来确定这是用户本人的行为。

## SSL 客户端认证必要的费用

# 基于表单的认证

不是在 HTTP 协议中定义的

## 认证多半为基于表单的认证

## Session 管理以及 Cookie 应用

1. 客户端将用户 ID 和密码等登陆信息放入报文的实体部分，通过 POST 请求发送给服务器

2. 服务器会发放用以识别用户的 Session ID。 通过验证客户端发送过来的登陆信息进行认证，然后将认证结果和 Session ID 进行绑定记录在服务端（向客户端返回响应的时候使用 set-cookie 字段来保存 session id）

3. 客户端收到响应之后将内容保存在 cookie 中，下次发送请求是会携带这个 cookie。session id 也会被携带，所以服务器就可以通过 session id 来验证用户的身份以及认证状态
