与 Node 的事件驱动、异步 I/O 设计理念比较相近的一个知名产品为 Nginx。Nginx 采用纯 C 编写，性能表现非常优异。

# 为什么需要异步 IO

## 用户体验

## 资源分配

对于两个互不相关的任务的执行方式

1. 单线程串行执行

2. 多线程并行执行

## ？？多线程存在的问题

1. 线程建立有开销

2. 状态同步

3. 锁

4. 上下文切换

## ？？多线程的有点

在多核 CPU 上可以提高 CPU 的利用率

**Node 给出的方案是：利用单线程，远离状态同步和线程死锁的问题；利用异步 IO，让单线程远离阻塞，更好的利用 CPU**

> 为了弥补 Node 单线程的弱点，Node 提供了子进程，该子进程可以通过工作进程高效的利用 CPU 和异步 IO

# 异步 I/O 实现现状

阻塞 I/O

CPU 会一直等待结果，无法进行其它操作，浪费 CPU 资源

非阻塞 I/O

CPU 可以进行其它的任务，采用轮询判断已经发出的任务是否执行完毕

**我们时常提到 NODE 是单线程的，但是这里的单线程是 node 在执行 JavaScript 时的单线程，但是无论什么平台（Linux/Windows）内部完成 I/O 操作的都另有线程池**

# Node 的异步 I/O

## 事件循环

进程启动时，Node 就像在执行一个 while(true)的循环，每执行一遍循环体，我们就称它为一次 Tick。每个 Tick 都会查看是否有事件待处理，如果有则取出它的回调函数，执行它们。执行完毕后再进入下一次事件循环，如果没有事件要处理就退出进程。

## 观察者

每个事件循环中有一个或者多个观察者，而判断是否有事件要处理的过程就是向这些观察者询问是否有要处理的事件。

## 请求对象

## 执行回调

事件循环，观察者，请求对象，I/O 线程池这四者共同构成了 Node 异步任务 I/O 模型的基本要素

## 小结

Javascript 是单线程的，按之前的理解来说，我们是无法充分利用多核 CPU 的

事实上，在 Node 中，除了 JavaScript 是单线程的，Node 本身是多线程的，只是 I/O 使用的 CPU 比较少。

除了用户的代码不能多线程执行以外，所有的 I/O（磁盘 I/O，网络 I/O）都是可以并行执行的
